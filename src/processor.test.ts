import { TestProcessorServer } from '@sentio/sdk/testing'
import { HandlerType, ProcessBindingsRequest } from "@sentio/sdk";

describe('Test Processor', () => {
  const service = new TestProcessorServer(async () => await import('./processor.js'))

  beforeAll(async () => {
    await service.start()
  })

  test('has config', async () => {
    const config = await service.getConfig({})
    expect(config.contractConfigs.length > 0)
  })

  test('check transaction', async () => {
    const request: ProcessBindingsRequest = {
      bindings: [
        {
          data: {
            aptEvent: {
              transaction: tx3
            }
          },
          handlerIds: [ 1 ],
          handlerType: HandlerType.APT_EVENT,
        },
      ],
    }
    const res = await service.processBindings(request)

    // service.processBindings(request)
  })

  const tx = {"id":"","round":"0","previous_block_votes":null,"proposer":"","sender":"0x8b5622eeb3df972cea6d73073494dc0368b6d43f75a71501cd92460e99536436","sequence_number":"6","payload":{"type":"entry_function_payload","type_arguments":[],"arguments":["0xaa90e0d9d16b63ba4a289fb0dc8d1b454058b21c9b5c76864f825d5c1f32582e",2,"0xb5e97db07fa0bd0e5598aa3643a9bc6f6693bddc1a9fec9e674a461eaa00b193aa90e0d9d16b63ba4a289fb0dc8d1b454058b21c9b5c76864f825d5c1f32582e030000000000000002000000000000000000000000000000000000000000000000000000000000000104636f696e087472616e73666572010700000000000000000000000000000000000000000000000000000000000000010a6170746f735f636f696e094170746f73436f696e0002208b5622eeb3df972cea6d73073494dc0368b6d43f75a71501cd92460e995364360800093d0000000000e8030000000000007800000000000000fae46a630000000001","0xcb0ae9f6e47530a9d37f9cc094dfc2a9b5c9a1ab6c65a7bb3c24ec28508593bc1b54e17b6be8110b6a5d97acfd6d01128e93fb7c31533979a7e059b8199ad00f"],"code":{"bytecode":""},"function":"0xaa90e0d9d16b63ba4a289fb0dc8d1b454058b21c9b5c76864f825d5c1f32582e::momentum_safe::init_transaction"},"max_gas_amount":"5308","gas_unit_price":"120","expiration_timestamp_secs":"1666139022","secondary_signers":[],"type":"user_transaction","timestamp":"1666135429439681","events":[
      {"version":"2183172","guid":{"creation_number":"8","account_address":"0xaa90e0d9d16b63ba4a289fb0dc8d1b454058b21c9b5c76864f825d5c1f32582e"},"sequence_number":"0","type":"0xaa90e0d9d16b63ba4a289fb0dc8d1b454058b21c9b5c76864f825d5c1f32582e::momentum_safe::Transaction","data":{"metadata":"0x","payload":"0xb5e97db07fa0bd0e5598aa3643a9bc6f6693bddc1a9fec9e674a461eaa00b193aa90e0d9d16b63ba4a289fb0dc8d1b454058b21c9b5c76864f825d5c1f32582e030000000000000002000000000000000000000000000000000000000000000000000000000000000104636f696e087472616e73666572010700000000000000000000000000000000000000000000000000000000000000010a6170746f735f636f696e094170746f73436f696e0002208b5622eeb3df972cea6d73073494dc0368b6d43f75a71501cd92460e995364360800093d0000000000e8030000000000007800000000000000fae46a630000000001","signatures":{"data":[{"key":"0x745a05201579729817f02983fd420d6072721fb87a73fbd31d7c6202c8459ae5","value":"0xcb0ae9f6e47530a9d37f9cc094dfc2a9b5c9a1ab6c65a7bb3c24ec28508593bc1b54e17b6be8110b6a5d97acfd6d01128e93fb7c31533979a7e059b8199ad00f"}]}}}],"version":"2183172","hash":"0xa14e17e6045ae5c0d67f784cc08256f207724bdc6b6c8031c1776af2dedfb09c","state_root_hash":"","event_root_hash":"0x11288d1a702203311b3823adc54f30c2e738666df76d87df2095bad070be5c18","gas_used":"4886","success":true,"vm_status":"Executed successfully","accumulator_root_hash":"0","changes":null}


  const tx2 = {"id":"","round":"0","previous_block_votes":null,"proposer":"","sender":"0xa3f6a53c57395401ce64f09a188e2259dc9b156387e76c88a7a80a8fe5254476","sequence_number":"8","payload":{"type":"entry_function_payload","type_arguments":[],"arguments":["0x6a9c8c988dbdf9849c54adc0a8cf868edc840642662002f9f0f81ec332250643",3,"0xb5e97db07fa0bd0e5598aa3643a9bc6f6693bddc1a9fec9e674a461eaa00b1936a9c8c988dbdf9849c54adc0a8cf868edc840642662002f9f0f81ec332250643010000000000000002000000000000000000000000000000000000000000000000000000000000000104636f6465137075626c6973685f7061636b6167655f74786e0002ff03fd03114d6f6d656e74756d536166652d746573740100000000000000004044373333363539323331363936353738374636423541353838434633333941414532413641323045443043393630453741353738323132423235384546443030fe011f8b08000000000002ff454ebd4ec33010defd145166da98248d1c2406163626c6aa4297f339b51affc8760208f1eed85054dd7277dfefd1035e60a613b360a87aacea1767c8a6d5bc82a25da2986ab65188dad982f27d9e9aad7e0e20e9cdbb45e36701d0190f494f0bd58c1d41ca4031523c3113b3d1aff4638011058e42c849aa51f4231e7a90c841a012832089a2e743df0e43cb79ab46c595b827ecbab63de47f579c2579b2922cea62fee4938bcf21577f77e19253beaa59a792764ec9c787a6c9e7799df6b95e0385bc5b608ad7155da07d26d477555c27a94311fe41c66dd4a87fe32bff766745a0add0256d96525d7db31f5ccada434b01000002076d65737361676500000009746573745f636f696e0000000300000000000000000000000000000000000000000000000000000000000000010e4170746f734672616d65776f726b00000000000000000000000000000000000000000000000000000000000000010b4170746f735374646c696200000000000000000000000000000000000000000000000000000000000000010a4d6f76655374646c696200ff0602fb04a11ceb0b050000000c01000c020c12031e20043e04054228076ad50108bf024006ff020a108903450ace03150ce3035f0dc20404000001010102010301040105000606000007080005080700030e040106010009000100000a020300020f0404000410060000011106080106031209030106040705070105010802020c08020001030305080207080101060c010800010b0301090002070b030109000900076d657373616765076163636f756e74056572726f72056576656e74067369676e657206737472696e67124d6573736167654368616e67654576656e740d4d657373616765486f6c64657206537472696e670b6765745f6d6573736167650b7365745f6d6573736167650c66726f6d5f6d6573736167650a746f5f6d657373616765156d6573736167655f6368616e67655f6576656e74730b4576656e7448616e646c65096e6f745f666f756e640a616464726573735f6f66106e65775f6576656e745f68616e646c650a656d69745f6576656e746a9c8c988dbdf9849c54adc0a8cf868edc840642662002f9f0f81ec332250643000000000000000000000000000000000000000000000000000000000000000103080000000000000000126170746f733a3a6d657461646174615f7630310100000000000000000b454e4f5f4d4553534147451b5468657265206973206e6f206d6573736167652070726573656e740002020b08020c08020102020008020d0b030108000001000101030b0a002901030607001102270b002b0110001402010104010105210e0011030c020a022901200308050f0e000b010e00380012012d0105200b022a010c040a041000140c030a040f010b030a01120038010b010b040f0015020100010100ff01a11ceb0b050000000a01000402040403080b04130205151007254308684006a801150abd01050cc2011200000101000200000003000100010503010100010201060c0001080005060c0a020a02020109746573745f636f696e0c6d616e616765645f636f696e0854657374436f696e0b696e69745f6d6f64756c650b64756d6d795f6669656c640a696e697469616c697a656a9c8c988dbdf9849c54adc0a8cf868edc840642662002f9f0f81ec33225064300000000000000000000000000000000000000000000000000000000000000010a020a095465737420436f696e0a0205045445535400020104010000000001070b000700070131060938000200c8310000000000007800000000000000bc7458630000000001","0x86bb017f9cffb48b192eddd38f2e36c8c90b2fc06d043a516e50a7778a87bbd6fe3ad563ff7fbfa3c57a8e9b1632c1cd591a9144d14ba3196dd49090812afb00"],"code":{"bytecode":""},"function":"0xaa90e0d9d16b63ba4a289fb0dc8d1b454058b21c9b5c76864f825d5c1f32582e::momentum_safe::init_transaction"},"max_gas_amount":"9702","gas_unit_price":"120","expiration_timestamp_secs":"1666741451","secondary_signers":[],"type":"user_transaction","timestamp":"1666136653340986","events":[{"version":"2196870","guid":{"creation_number":"5","account_address":"0x6a9c8c988dbdf9849c54adc0a8cf868edc840642662002f9f0f81ec332250643"},"sequence_number":"0","type":"0xaa90e0d9d16b63ba4a289fb0dc8d1b454058b21c9b5c76864f825d5c1f32582e::momentum_safe::Transaction","data":{"metadata":"0x","payload":"0xb5e97db07fa0bd0e5598aa3643a9bc6f6693bddc1a9fec9e674a461eaa00b1936a9c8c988dbdf9849c54adc0a8cf868edc840642662002f9f0f81ec332250643010000000000000002000000000000000000000000000000000000000000000000000000000000000104636f6465137075626c6973685f7061636b6167655f74786e0002ff03fd03114d6f6d656e74756d536166652d746573740100000000000000004044373333363539323331363936353738374636423541353838434633333941414532413641323045443043393630453741353738323132423235384546443030fe011f8b08000000000002ff454ebd4ec33010defd145166da98248d1c2406163626c6aa4297f339b51affc8760208f1eed85054dd7277dfefd1035e60a613b360a87aacea1767c8a6d5bc82a25da2986ab65188dad982f27d9e9aad7e0e20e9cdbb45e36701d0190f494f0bd58c1d41ca4031523c3113b3d1aff4638011058e42c849aa51f4231e7a90c841a012832089a2e743df0e43cb79ab46c595b827ecbab63de47f579c2579b2922cea62fee4938bcf21577f77e19253beaa59a792764ec9c787a6c9e7799df6b95e0385bc5b608ad7155da07d26d477555c27a94311fe41c66dd4a87fe32bff766745a0add0256d96525d7db31f5ccada434b01000002076d65737361676500000009746573745f636f696e0000000300000000000000000000000000000000000000000000000000000000000000010e4170746f734672616d65776f726b00000000000000000000000000000000000000000000000000000000000000010b4170746f735374646c696200000000000000000000000000000000000000000000000000000000000000010a4d6f76655374646c696200ff0602fb04a11ceb0b050000000c01000c020c12031e20043e04054228076ad50108bf024006ff020a108903450ace03150ce3035f0dc20404000001010102010301040105000606000007080005080700030e040106010009000100000a020300020f0404000410060000011106080106031209030106040705070105010802020c08020001030305080207080101060c010800010b0301090002070b030109000900076d657373616765076163636f756e74056572726f72056576656e74067369676e657206737472696e67124d6573736167654368616e67654576656e740d4d657373616765486f6c64657206537472696e670b6765745f6d6573736167650b7365745f6d6573736167650c66726f6d5f6d6573736167650a746f5f6d657373616765156d6573736167655f6368616e67655f6576656e74730b4576656e7448616e646c65096e6f745f666f756e640a616464726573735f6f66106e65775f6576656e745f68616e646c650a656d69745f6576656e746a9c8c988dbdf9849c54adc0a8cf868edc840642662002f9f0f81ec332250643000000000000000000000000000000000000000000000000000000000000000103080000000000000000126170746f733a3a6d657461646174615f7630310100000000000000000b454e4f5f4d4553534147451b5468657265206973206e6f206d6573736167652070726573656e740002020b08020c08020102020008020d0b030108000001000101030b0a002901030607001102270b002b0110001402010104010105210e0011030c020a022901200308050f0e000b010e00380012012d0105200b022a010c040a041000140c030a040f010b030a01120038010b010b040f0015020100010100ff01a11ceb0b050000000a01000402040403080b04130205151007254308684006a801150abd01050cc2011200000101000200000003000100010503010100010201060c0001080005060c0a020a02020109746573745f636f696e0c6d616e616765645f636f696e0854657374436f696e0b696e69745f6d6f64756c650b64756d6d795f6669656c640a696e697469616c697a656a9c8c988dbdf9849c54adc0a8cf868edc840642662002f9f0f81ec33225064300000000000000000000000000000000000000000000000000000000000000010a020a095465737420436f696e0a0205045445535400020104010000000001070b000700070131060938000200c8310000000000007800000000000000bc7458630000000001","signatures":{"data":[{"key":"0xa11beec494a2ae664e1b47e331d0c7c289a786ca73afcf0cfef52814c7210a2c","value":"0x86bb017f9cffb48b192eddd38f2e36c8c90b2fc06d043a516e50a7778a87bbd6fe3ad563ff7fbfa3c57a8e9b1632c1cd591a9144d14ba3196dd49090812afb00"}]}}}],"version":"2196870","hash":"0x8298001eb45a6cb6108a34af0bed030b2d4f765e38aa1321a5e0e3e50c348471","state_root_hash":"","event_root_hash":"0x79802833143a85bf92d6f033d20c38b90207e9a860668130352062c6151fd608","gas_used":"6528","success":true,"vm_status":"Executed successfully","accumulator_root_hash":"0","changes":null}



  const tx3 = {"changes":null,"round":"0","sequence_number":"13","gas_used":"5684","timestamp":"1673336625877665","event_root_hash":"0x4b4f642f56e13efd0735d7a180e08bc0c226c8578347de85f9c3ae321afc7517","success":true,"previous_block_votes":null,"proposer":"","type":"user_transaction","expiration_timestamp_secs":"1704872619","secondary_signers":[],
        "events": [
          {
            "guid": {
              "creation_number": "5",
              "account_address": "0xf0c72440ff8493c383b3f97ea79e5ffc136b132567de27eb442d90c2b6534448"
            },
            "sequence_number": "13",
            "type": "0xaa90e0d9d16b63ba4a289fb0dc8d1b454058b21c9b5c76864f825d5c1f32582e::momentum_safe::Transaction",
            "data": {
              "metadata": "0x",
              "payload": "0xb5e97db07fa0bd0e5598aa3643a9bc6f6693bddc1a9fec9e674a461eaa00b193f0c72440ff8493c383b3f97ea79e5ffc136b132567de27eb442d90c2b653444806000000000000000200000000000000000000000000000000000000000000000000000000000000010d6170746f735f6163636f756e74087472616e73666572000220f1b672b31daf44cb1cafa92fb8643a6826a88256f3149d1c86aa8af03c2acb4408404b4c0000000000a00f00000000000064000000000000002307221d0100000001",
              "signatures": {
                "data": [
                  {
                    "key": "0x00f61cabd72f1fe6ee5791547d3d0aeccbdfca2a74393a6c2efc5deb88357f39",
                    "value": "0xd9066d58e76bed4559f55f51b8ce5c13980ec0787ce2a3df3d66e61d1e037c38210b5a80290e1cbd14d1306bb51e0b5338b77601949416ea17b47424b1014e07"
                  }
                ]
              }
            }
          }
        ],
    "hash":"0x8cf3085b38e984f578a03adef82d025c13cc354ae933c9ebaf564cb0fdc4da67","state_root_hash":"","id":"","sender":"0x7f765c40e130e08e966665529e2173e7dae391a5d26382f3da1fa159c18d388e","payload":{"type":"entry_function_payload","type_arguments":[],"arguments":["0xf0c72440ff8493c383b3f97ea79e5ffc136b132567de27eb442d90c2b6534448",0,"0xb5e97db07fa0bd0e5598aa3643a9bc6f6693bddc1a9fec9e674a461eaa00b193f0c72440ff8493c383b3f97ea79e5ffc136b132567de27eb442d90c2b653444806000000000000000200000000000000000000000000000000000000000000000000000000000000010d6170746f735f6163636f756e74087472616e73666572000220f1b672b31daf44cb1cafa92fb8643a6826a88256f3149d1c86aa8af03c2acb4408404b4c0000000000a00f00000000000064000000000000002307221d0100000001","0xd9066d58e76bed4559f55f51b8ce5c13980ec0787ce2a3df3d66e61d1e037c38210b5a80290e1cbd14d1306bb51e0b5338b77601949416ea17b47424b1014e07"],"code":{"bytecode":""},"function":"0xaa90e0d9d16b63ba4a289fb0dc8d1b454058b21c9b5c76864f825d5c1f32582e::momentum_safe::init_transaction"},"vm_status":"Executed successfully","accumulator_root_hash":"0","max_gas_amount":"50000","gas_unit_price":"120","version":"66196570"}

})
